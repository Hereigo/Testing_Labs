<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
</head>

<body>

    <script src="node_modules/vss-web-extension-sdk/lib/VSS.SDK.min.js"></script>

    <script>
        var changedFieldCount = [];
        var changedFields = [];
        // Sets up the initial handshake with the host frame
        VSS.init({
            // Our extension explicitly notifies the host when we're done loading
            explicitNotifyLoaded: true,
            // We are using some Azure DevOps Services APIs, so we need the module loader to load them in
            usePlatformScripts: true,
            usePlatformStyles: true
        });

        // "System.State": "Active",

        // "Microsoft.VSTS.Common.StateChangeDate": "2019-12-20T09:14:52.970Z",

        VSS.register("sample-work-item-form-observer-2", function (context) {
            return {
                // Work item changes EVENT HANDLERS :
                onFieldChanged: function (args) {
                    if (!changedFields[args.id]) {
                        changedFields[args.id] = [];
                        changedFieldCount[args.id] = 0;
                    }

                    $.each(args.changedFields, function (key, value) {
                        if (!changedFields[args.id][key]) {
                            changedFields[args.id][key] = value;
                            changedFieldCount[args.id]++;
                        }
                    });
                },
                onLoaded: function (args) {
                },
                onUnloaded: function (args) {
                },
                onSaved: function (args) {
                    changedFieldCount[args.id] = 0;
                    changedFields[args.id] = [];
                },
                onReset: function (args) {
                    changedFieldCount[args.id] = 0;
                    changedFields[args.id] = [];
                },
                onRefreshed: function (args) {
                    changedFieldCount[args.id] = 0;
                    changedFields[args.id] = [];
                }
            };
        });


        VSS.notifyLoadSucceeded();
    </script>
</body>

</html>